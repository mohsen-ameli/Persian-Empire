{% extends "blog/base.html" %}
{% load crispy_forms_tags %}
{% block content %}
  <div class="content-section">
    <!-- TinyMCE -->
    <script src="https://cdn.tiny.cloud/1/no-api-key/tinymce/5/tinymce.min.js"></script>
    <script>
    tinymce.init({
      selector: "textarea",  // change this value according to your HTML
      plugins: "image",
      menubar: "insert",
      toolbar: "image",
      image_uploadtab: false,
      selector: 'textarea',  // change this value according to your HTML
      plugins : 'advlist autolink link image lists charmap print preview'
    });

    tinymce.init({
      selector: 'textarea',  // change this value according to your HTML
      images_upload_handler: function (blobInfo, success, failure) {
    	var xhr, formData;
    	xhr = new XMLHttpRequest();
    	xhr.withCredentials = false;
    	xhr.open('POST', 'postAcceptor.php');
    	xhr.onload = function() {
    	  var json;

    	  if (xhr.status != 200) {
    		failure('HTTP Error: ' + xhr.status);
    		return;
    	  }
    	  json = JSON.parse(xhr.responseText);

    	  if (!json || typeof json.location != 'string') {
    		failure('Invalid JSON: ' + xhr.responseText);
    		return;
    	  }
    	  success(json.location);
    	};
    	formData = new FormData();
    	formData.append('file', blobInfo.blob(), fileName(blobInfo));
    	xhr.send(formData);
      }
    });


    </script>
    <form method="POST">
      {% csrf_token %}
      <fieldset class="form-group">
        <legend class="boarde-dutton mb-4">Blog Post</legend>
        {{ form|crispy }}
      </fieldset>
      <div class="form-group">
        <button class="btn btn-success" type="submit">Post !</button>
      </div>
    </form>
  </div>
{% endblock content %}
